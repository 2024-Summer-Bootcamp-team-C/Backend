<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>위인과 대화하기</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .chat-container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 50px;
        }
        .message {
            margin-bottom: 10px;
        }
        .user-message {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
        }
        .gpt-message {
            background-color: #d3f8e2;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container chat-container">
        <h2>위인과 대화하기</h2>
        <div id="chat-messages">
        </div>
        <div class="input-group mt-3">
            <input type="text" id="user-input" class="form-control" placeholder="메시지를 입력하세요...">
            <div class="input-group-append">
                <button class="btn btn-primary" id="send-btn">전송</button>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function() {
        var story_id = "{{ story_id }}";

        var socket = new WebSocket(
            'ws://' + window.location.host +
            '/ws/chat/' + story_id + '/'
        );

        socket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var gptMessage = data['message'];

            var gptMessageHTML = '<div class="message gpt-message"><strong>GPT:</strong> ' + gptMessage + '</div>';
            $("#chat-messages").append(gptMessageHTML);
        };

        $("#send-btn").click(function() {
            sendMessage();
        });

        $("#user-input").keypress(function(event) {
            if (event.which === 13) {
                sendMessage();
            }
        });

        function sendMessage() {
            var userMessage = $("#user-input").val().trim();
            if (userMessage !== "") {
                var userMessageHTML = '<div class="message user-message"><strong>당신:</strong> ' + userMessage + '</div>';
                $("#chat-messages").append(userMessageHTML);

                socket.send(JSON.stringify({
                    'message': userMessage
                }));

                $("#user-input").val("");
            }
        }
    });
    </script>
</body>
</html>
